
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>é€æç´€éŒ„ç³»çµ±ï¼ˆæœ¬åœ°å„²å­˜ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
</head>
<body>
<div id="app" class="container py-4">
  <h3 class="mb-3">ğŸ§‘â€âš•ï¸ å¤šç—…æ‚£é€æç´€éŒ„ç³»çµ±</h3>

  <!-- ç—…æ‚£é¸æ“‡èˆ‡æ–°å¢ -->
  <div class="card p-3 mb-4">
    <h5>é¸æ“‡ç—…æ‚£</h5>
    <select v-model="selectedPatientId" class="form-select mb-2">
      <option v-for="p in patients" :value="p.id">{{ p.name }}ï¼ˆ{{ p.birth }}ï¼‰</option>
    </select>
    <button class="btn btn-outline-success" @click="addNewPatient">â• æ–°å¢ç—…æ‚£</button>
  </div>

  <!-- ç—…æ‚£è³‡æ–™èˆ‡ç´€éŒ„ -->
  <div v-if="currentPatient" class="card p-3 mb-4">
    <h5>ç—…æ‚£è³‡æ–™</h5>
    <input v-model="currentPatient.name" class="form-control mb-2" placeholder="å§“å" />
    <input v-model="currentPatient.birth" type="date" class="form-control mb-2" />
    <input v-model="currentPatient.phone" class="form-control mb-2" placeholder="é›»è©±" />

    <h5 class="mt-3">é€æç´€éŒ„</h5>
    <div class="row g-2 mb-2">
      <div class="col"><input v-model="record.date" type="date" class="form-control" /></div>
      <div class="col"><input v-model="record.weight" type="number" class="form-control" placeholder="é«”é‡ (kg)" /></div>
      <div class="col"><input v-model="record.uf" type="number" class="form-control" placeholder="è¶…æ¿¾é‡ (L)" /></div>
      <div class="col"><button class="btn btn-primary w-100" @click="addRecord">æ–°å¢</button></div>
    </div>

    <table class="table table-sm table-bordered">
      <thead><tr><th>æ—¥æœŸ</th><th>é«”é‡(kg)</th><th>è¶…æ¿¾é‡(L)</th><th>æ“ä½œ</th></tr></thead>
      <tbody>
        <tr v-for="(r, i) in currentPatient.records">
          <td><input v-model="r.date" class="form-control form-control-sm" /></td>
          <td><input v-model="r.weight" class="form-control form-control-sm" /></td>
          <td><input v-model="r.uf" class="form-control form-control-sm" /></td>
          <td><button class="btn btn-sm btn-danger" @click="deleteRecord(i)">åˆªé™¤</button></td>
        </tr>
      </tbody>
    </table>

    <button class="btn btn-outline-secondary mt-2" @click="downloadCSV">ä¸‹è¼‰ç´€éŒ„</button>
  </div>
</div>

<script>
const STORAGE_KEY = 'dialysisPatients';
const app = Vue.createApp({
  data() {
    return {
      patients: [],
      selectedPatientId: null,
      record: { date: '', weight: '', uf: '' }
    };
  },
  computed: {
    currentPatient() {
      return this.patients.find(p => p.id === this.selectedPatientId);
    }
  },
  methods: {
    addNewPatient() {
      const id = Date.now().toString();
      const newPatient = { id, name: '', birth: '', phone: '', records: [] };
      this.patients.push(newPatient);
      this.selectedPatientId = id;
      this.save();
    },
    addRecord() {
      if (!this.record.date || !this.record.weight) return alert('è«‹å®Œæ•´å¡«å¯«');
      this.currentPatient.records.push({ ...this.record });
      this.record = { date: '', weight: '', uf: '' };
      this.save();
    },
    deleteRecord(i) {
      this.currentPatient.records.splice(i, 1);
      this.save();
    },
    downloadCSV() {
      const rows = this.currentPatient.records.map(r => `${r.date},${r.weight},${r.uf}`);
      const csv = `æ—¥æœŸ,é«”é‡(kg),è¶…æ¿¾é‡(L)
` + rows.join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${this.currentPatient.name}_dialysis.csv`;
      link.click();
    },
    save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(this.patients));
    },
    load() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) this.patients = JSON.parse(saved);
    }
  },
  mounted() {
    this.load();
  }
});
app.mount('#app');
</script>
</body>
</html>
